<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dead Poets ‚Äî Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600&family=Cormorant+Garamond:wght@300;400;500&display=swap');

:root {
  --black: #0a0a0a;
  --dark: #111;
  --white: #f5f5f5;
  --gray: #ccc;
  --border: #222;
  --gold: #d4c295;
  --red: #a83a3a; 
  --red-dark: #7d2a2a;
}

body {
  margin: 0;
  background: var(--black);
  color: var(--white);
  font-family: 'Cormorant Garamond', serif;
}

/* NAVBAR */
nav {
  background: var(--dark);
  padding: 15px 25px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid var(--border);
}

nav h2 {
  margin: 0;
  font-family: 'Playfair Display', serif;
  font-size: 26px;
}

nav button {
  background: var(--red);
  border: 1px solid var(--border);
  padding: 8px 16px;
  color: var(--white);
  border-radius: 6px;
  cursor: pointer;
  font-family: 'Playfair Display', serif;
  transition: 0.2s;
}

nav button:hover {
  background: var(--red-dark);
}

/* LAYOUT */
.dashboard {
  display: grid;
  grid-template-columns: 240px 1fr;
  min-height: 100vh;
}

/* SIDEBAR */
.sidebar {
  background: var(--dark);
  padding: 20px;
  border-right: 1px solid var(--border);
}

.sidebar div {
  padding: 12px;
  border-radius: 6px;
  cursor: pointer;
  margin-bottom: 8px;
  color: var(--gray);
  font-family: 'Playfair Display', serif;
  transition: 0.2s;
}

.sidebar div:hover { 
  background: #1a1a1a;
  color: var(--white);
}

/* CONTENT */
.content {
  padding: 30px;
}

.content h2 {
  margin-top: 0;
  font-family: 'Playfair Display', serif;
  font-size: 26px;
}

/* CARDS */
.cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.card {
  background: var(--dark);
  padding: 20px;
  border-radius: 12px;
  border: 1px solid var(--border);
  box-shadow: 0 0 20px rgba(0,0,0,0.5);
}

.card h3 {
  margin: 0;
  font-family: 'Playfair Display', serif;
}

/* TABLES */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
}

table th {
  text-align: left;
  padding: 12px;
  border-bottom: 1px solid var(--border);
  font-family: 'Playfair Display', serif;
  font-size: 16px;
}

table td {
  padding: 12px;
  border-bottom: 1px solid #1a1a1a;
  color: var(--gray);
}

table tr:hover {
  background: var(--dark);
}

/* ACTION BUTTONS */
button {
  background: var(--red);
  border: 1px solid var(--border);
  padding: 6px 10px;
  border-radius: 6px;
  cursor: pointer;
  color: var(--white);
  font-family: 'Playfair Display', serif;
  transition: 0.2s;
}

button:hover {
  background: var(--red-dark);
}

/* MOBILE */
@media (max-width: 768px) {
  .dashboard { grid-template-columns: 1fr; }
  .sidebar { display: flex; overflow-x: auto; }
  .sidebar div { margin-right: 10px; }
}

.bottom-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 65px;
  background: #111;
  border-top: 1px solid #222;
  display: flex;
  justify-content: space-around;
  align-items: center;
  font-family: 'Playfair Display', serif;
  z-index: 1000;
}

.bottom-nav div {
  text-align: center;
  color: #f5f5f5;
  font-size: 20px;
  cursor: pointer;
  width: 25%;
}

.bottom-nav span {
  display: block;
  font-size: 12px;
  color: #ccc;
}

.bottom-nav div:hover {
  color: #d4c295;
}
  </style>

</head>
<body>

<nav>
  <h2>Dead Poets ‚Äî Admin</h2>
  <button onclick="logout()">Logout</button>
</nav>

<div class="dashboard">
  <div class="sidebar">
    <div onclick="showDashboard()">üìä Dashboard</div>
    <div onclick="showUsers()">üë• Users</div>
    <div onclick="showPoems()">üìú Poems</div>
    <div onclick="showReports()">üö® Reports</div>
  </div>

  <div class="content" id="content-section">
    <h2>Welcome, Admin</h2>
    <p>Manage poets. Curate art. Control the rebellion.</p>
  </div>
</div>

<script>
const API = window.location.hostname === "localhost"
  ? "http://localhost:5000/api"
  : "/api";

function logout(){
  localStorage.clear();
  window.location.href = "/";
}

/* --------------------
   DASHBOARD
--------------------- */
async function showDashboard() {
  const users = await fetch(`${API}/users`).then(res => res.json());
  const poems = await fetch(`${API}/poems`).then(res => res.json());
  const reports = await fetch(`${API}/reports`).then(res => res.json());

  document.getElementById("content-section").innerHTML = `
    <h2>Dashboard Overview</h2>
    <div class="cards">
      <div class="card"><h3>Users</h3><p>${users.length}</p></div>
      <div class="card"><h3>Poems</h3><p>${poems.length}</p></div>
      <div class="card"><h3>Reports</h3><p>${reports.length}</p></div>
    </div>
  `;
}

/* --------------------
   USERS
--------------------- */
async function showUsers(){
  const users = await fetch(`${API}/users`).then(res => res.json());

  let html = `
    <h2>Registered Users</h2>
    <table>
      <tr><th>ID</th><th>Name</th><th>Email</th><th>Role</th><th>Action</th></tr>
  `;

  users.forEach(user => {
    html += `
      <tr>
        <td>${user.id}</td>
        <td>${user.name}</td>
        <td>${user.email}</td>
        <td>${user.role}</td>
        <td><button onclick="deleteUser(${user.id})">‚ùå Delete</button></td>
      </tr>
    `;
  });

  html += "</table>";
  document.getElementById("content-section").innerHTML = html;
}

/* --------------------
   POEMS
--------------------- */
async function showPoems(){
  const poems = await fetch(`${API}/poems`).then(res => res.json());

  let html = `
    <h2>All Poems</h2>
    <table>
      <tr><th>ID</th><th>Title</th><th>Author</th><th>Action</th></tr>
  `;

  poems.forEach(poem => {
    html += `
      <tr>
        <td>${poem.id}</td>
        <td>${poem.title}</td>
        <td>${poem.name}</td>
        <td><button onclick="deletePoem(${poem.id})">üóë Delete</button></td>
      </tr>
    `;
  });

  html += "</table>";
  document.getElementById("content-section").innerHTML = html;
}

/* --------------------
   REPORTS
--------------------- */
async function showReports(){
  const reports = await fetch(`${API}/reports`).then(res => res.json());

  let html = `
    <h2>Reports</h2>
    <table>
      <tr><th>ID</th><th>Poem</th><th>Reporter</th><th>Reason</th><th>Actions</th></tr>
  `;

  if (reports.length === 0) {
    html += `<tr><td colspan="5">No reports yet</td></tr>`;
  } else {
    reports.forEach(report => {
      html += `
        <tr>
          <td>${report.id}</td>
          <td>${report.poem_title}</td>
          <td>${report.reporter}</td>
          <td>${report.reason}</td>
          <td>
            <button onclick="deletePoem(${report.poem_id})">üóë Delete Poem</button>
            <button onclick="deleteReport(${report.id})" style="margin-left:5px;">‚ùå Remove Report</button>
          </td>
        </tr>
      `;
    });
  }

  html += "</table>";
  document.getElementById("content-section").innerHTML = html;
}

/* --------------------
   ACTIONS
--------------------- */
async function deletePoem(poemId) {
  if (!confirm("Delete this poem?")) return;

  const res = await fetch(`${API}/poems/${poemId}`, { method: "DELETE" });
  const data = await res.json();

  if (data.success) {
    alert("Poem deleted ‚úì");
    showReports();
  } else {
    alert("Delete failed ‚ùå");
  }
}

async function deleteUser(id) {
  if (!confirm("Delete this user? All poems will also be removed.")) return;

  const res = await fetch(`${API}/users/${id}`, { method: "DELETE" });
  const data = await res.json();

  if (data.success) {
    alert("User deleted ‚úì");
    showUsers();
  } else {
    alert("Failed to delete user ‚ùå");
  }
}

async function deleteReport(id) {
  if (!confirm("Remove this report?")) return;

  const res = await fetch(`${API}/reports/${id}`, { method: "DELETE" });
  const data = await res.json();

  if (data.success) {
    alert("Report removed ‚úì");
    showReports();
  } else {
    alert("Failed to remove report ‚ùå");
  }
}

showDashboard();
</script>

<div class="bottom-nav">
  <div onclick="window.location.href='home.html'">üè†<span>Home</span></div>
  <div onclick="window.location.href='profile.html'">üë§<span>Profile</span></div>
  <div onclick="window.location.href='/'">üö™<span>Logout</span></div>
</div>

</body>
</html>
